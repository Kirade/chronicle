# Daily Learning: 2025-01-15

## 📚 What I Learned Today
- 안정 해싱 설계(Consistent Hashing)
    - 배경
        - Scale Out 을 위해서는 요청이나 데이터를 서버에 균등하게 나누는 것이 중요하다.
        - 일반적으로 해싱을 통한 키 배치를 통해 어떤 요청이나 데이터를 어떤 서버에 접근하거나 적재하게 할지를 결정하게 된다. 해싱된 결과의 분포가 이상적인 상황에서는 일반적인 해싱으로도 서버별로 균등하게 요청과 데이터가 균등하게 분포하게 할 수 있다.
        -  하지만, 요청이나 데이터가 항상 이상적일 가능성이 높지않으므로 일반적인 해싱 전략을 통해서는 서버들간의 균등한 워크로드의 분배를 달성하기 어렵다.
        - 이런 문제릃 해결하깅 위한 아이디어가 안정 해싱 전략이다.
    - 안정 해싱 구현
        - 기본 구현
            - 해시 공간의 시작과 끝 점을 연결하여 해시 링을 생성한다. 그리고 서버 노드를 해시 링에 균등하게 배치한다. 해싱된 데이터의 키도 이 링 위에 배치되게 되는데 배치된 위치에서 시계방향으로 가장 가까운 서버 노드로 요청이나 데이터를 보내는것이 기본 원리이다.
            - 서버가 추가되는 경우, 추가되는 서버의 시계방향에 있던 서버로 가던 워크로드의 일부가 새로 추가된 서버로 변경되게 된다.
            - 이것이 일반적인 구현인데 이것에는 문제점이 있다. 각 서버가 담당하는 파티션의 크기가 균등하게 유지되기가 어렵고, 키가 균등 분포를 달성하기 어렵다는 점이다.
        - 개선
            - 이 문제를 개선하기 위해 가상 노드 개념을 도입하는데, 해시 링 위에 위치한 서버 노드를 가상으로 복제하여 해시 링 위에 적절히 분포시키는 것이다. 각 가상 노드는 복제된 원본 서버 노드와 동일한 역할을하며 이 가상 노드가 선택되면 가상노드의 원본 서버로 라우팅을 하게된다.
            - 가상 노드의 개수가 늘어나면 늘어날수록 기본 구현에 있었던 문제들이 줄어들게된다.

- How discord scaled Elixir to 5,000,000 concurrent users
    - https://discord.com/blog/how-discord-scaled-elixir-to-5-000-000-concurrent-users
    - [Discord - 장애 보고서](https://discordstatus.com/incidents/dj3l6lw926kl)
    - 디스코드는 엘릭서를 활용해서 만들어졌다. 위의 문서는 디스코드에서 많은 사용자가 몰릴 때 어떤 문제가 있었고 이것을 엘릭서를 통해 어떻게 풀어냈는지 단계별로 설명해주는 문서이다.
    - 이 과정에 안정 해싱 개념을 활용하여 들어오는 트래픽을 프로세스들에 적절히 분배하는 방식을 사용했다.
    - 위의 문제들을 해결해 나가는 과정에 생성한 라이브러리나 참고한 문서들을 깃헙에 잘 정리해서 오픈소스로 공개 해두었다.
