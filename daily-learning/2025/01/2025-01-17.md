# Daily Learning: 2025-01-17

## 📚 What I Learned Today
- 키-값 저장소 설계
    - 키-값 데이터베이스라고 불리는 비 관계형 데이터베이스이다. 키를 통해 값을 접근할 수 있고 값은 여러가지 데이터 타입이 될 수 있다.

    - 단일 키-값 저장소
        - 단일 키값 저장소는 빠른 속도를 보장할 수 있지만, 메모리의 용량에 한계가 있고 메모리를 넘어선다면 디스크에 저장해야하기 때문에 성능상 문제가 발생할 수 있다.
    - 분산 키-값 저장소
        - 분산 해시 테이블이라고도 부른다.
        - CAP 정리
            - Consistency, Availability, Partition Tolerance
            - 위의 3가지 요구사항을 동시에 만족시키는 분산 시스템을 설계하는 것은 불가하다.
            - 시스템은 위에서 두 가지 요구사항을 만족시킬 수 있는데, Partition Tolerance 조건은 네트워크 장애는 피할수 없는 상황이기 때문에 반드시 요구사항중에 포함되어야 하는 항목이다. 따라서 CP, AP 시스템만 존재한다.
        - 실세계에서 파티션 문제가 발생하면, 일관성과 가용성 사이에 하나를 선택해야한다. 뱅킹시스템같은 경우 일관성을 선택하면서 잠시동안 오류를 반환하는 형태가 될 가능성이 높고, 가용성이 중요한 시스템은 일관성있지는 않지만 요청에 대한 응답을 빠르게 해주는 형태로 설계 할 수 있다.

    - 데이터 파티션
        - 대용량 데이터를 한 대의 서버에 넣는것은 불가능 하다. 따라서 여러대의 서버를 활용해 데이터를 작은 파티션으로 분리해 분산 저장 하는 방식이 일반적이다. 이 때 데이터를 서버간 고르게 분산시키고 노드의 추가 / 삭제 과정에 발생하는 데이터의 이동을 최소화하기위해 안정 해싱 전략을 자주 사용한다.
        - 안정 해싱을 통해 Auto Scaling 이 가능하고, 서버별 성능을 다르게 가져가면서 가상 노드의 개수를 자유롭게 조절할 수 있다.
    - 데이터 다중화
        - 동일한 데이터를 하나에 서버에만 두는것이 아니라 여러 서버로 분산시키는 전략이다. 같은 데이터를 해시링에서 원본 데이터가 저장된 서버 시계방향에 있는 N 개에 서버에 저장한다.
        - 가상노드가 있어서 동일한 서버가 있을 수 있는데, 동일한 서버가 선택되지 않도록 해야한다.
    - 데이터 일관성
        - 다중화된 데이터는 서로 다른 서버에 있기 때문에 일관성을 위한 동기화 작업이 필요하다.
        - 일반적으로 정족수 합의 프로토콜을 사용한다.
            - N: 사본의 개수
            - W: 쓰기 연산에 대한 정족수
            - R: 읽기 연산에 대한 정족수
        - 빠른 읽기 연산을 보장하려면 읽기 연산에 대한 정족수가 낮아야 하고, 빠른 쓰기 연산을 보장하려면 쓰기 연산에 대한 정족수가 낮아야 한다.
        - 데이터 정합성이 중요하다면 사본의 개수 N개 보다 읽기, 쓰기 연산의 정족수가 높도록 설정하면된다. 데이터가 정합성이 중요하지 않않은경우 반대이다.
        - R = 1, W = N: 빠른 읽기 연산 최적화
        - W = 1, R = N: 빠른 쓰기 연산 최적화
        - R + W >= N: 강한 데이터 일관성
        - R + W <= N: 약한 데이터 일관성
    - 일관성 모델
        - 강한 일관성: 낡은 데이터를 제공하지 않는다.
        - 약한 일관성: 낡은 데이터가 반환될 수 있다.
        - 최종 일관성: 갱신 결과는 모든 사본에 반영이 된다.

    - 장애 처리 / 장애 감지
        - 가십 프로토콜 같은 분산형 장애감지 솔루션이 효율적이다.
        - 각 노드가 멤버십 목록을 유지하고, 자신의 카운트를 지속적으로 증가시킨다.
        - 멤버십 정보를 다른 노드에 지속적으로 전달하는데, 만약 어떤 노드의 카운터 정보가 노후되어있으면 offline 으로 판단한다.
        - 일시적 장애 처리
            - 서버가 복구된 경우, 쌓인 변경 내역들을 일관 반영하여 데이터 일관성을 유지한다.
        - 영구 장애 처리
            - 머클 트리를 활용하여 데이터 일관성이 틀어진 부분을 효율적으로 찾고 일관성에 맞게 갱신한다.
        - 데이터 센터 장애
